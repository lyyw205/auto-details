# HANDOFF

## Current [1770957841]
- **Task**: Agent1 분석/추출 스킬 → Mapping 시스템 교체 + 프로젝트 클린업 + Gemini 프롬프트 강화
- **Completed**:
  - 기존 분석/추출 스킬 7개 삭제 (analyze-ref v1/v2/v4, extract-widgets v1/v2/v3/v5)
  - `/home/iamooo/repos/mapping/` → `mapping/` 프로젝트 내 복사 (Gemini Vision 매핑 웹앱)
  - 새 스킬 `/map-reference` 생성 (`skills/map-reference.skill.md`)
  - `agents/ref-to-widgets.md` 새 파이프라인으로 업데이트 (map-reference → register-widgets)
  - 불필요 파일 전면 삭제: `_archive/`, `figma-plugin/`, `prompts/`, `HANDOFF.md`, `PROJECT-SUMMARY.md`, `QUICKSTART-GUIDE.md`, `REFACTOR-PLAN.md`, `README.md`, `크래프트볼트/`
  - `templates/html-section-patterns.md` 삭제 (고정 레이아웃 패턴)
  - 레이아웃 강제 규칙 전면 제거: composition type 강제, 배경 교차 규칙, FeatureDetail zigzag, 9-grid 제약
  - Gemini 프롬프트에 style 정보 추가 (fontSize, fontWeight, color, textAlign, bgColor)
  - `Bound` 타입에 `BoundStyle` 인터페이스 추가
  - Properties 패널에 Style 섹션 추가 (컬러피커 포함)
  - `bounds-to-widget.ts` 생성 — bounds → `.widget.html` 변환 로직
  - Toolbar에 Widget 버튼 추가 (JSON + .widget.html 동시 다운로드)
  - CLAUDE.md 새 파이프라인 반영 완료
  - `.gitignore`에 mapping 관련 항목 추가
- **Next Steps**:
  - 실제 레퍼런스 이미지로 E2E 테스트 (Analyze → 편집 → Widget 다운로드)
  - 다운로드된 `.widget.html`을 갤러리에서 렌더 확인
  - `register-widgets` 스킬이 새 포맷 위젯을 정상 등록하는지 확인
  - 필요 시 섹션 분할 로직 추가 (긴 레퍼런스 → 여러 섹션 위젯으로 분리)
- **Blockers**: None
- **Related Files**:
  - `mapping/src/lib/gemini-prompt.ts` (강화된 프롬프트)
  - `mapping/src/lib/types.ts` (BoundStyle 추가)
  - `mapping/src/lib/bounds-to-widget.ts` (위젯 변환)
  - `mapping/src/components/panel/bound-properties.tsx` (Style UI)
  - `mapping/src/components/app-shell.tsx` (Export Widget 로직)
  - `mapping/src/components/toolbar.tsx` (Widget 버튼)
  - `mapping/src/app/api/analyze/route.ts` (style 파싱)
  - `skills/map-reference.skill.md` (새 스킬)
  - `agents/ref-to-widgets.md` (새 파이프라인)
  - `CLAUDE.md` (업데이트됨)
